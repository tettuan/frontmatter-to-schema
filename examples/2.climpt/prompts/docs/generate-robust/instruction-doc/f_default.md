---
c1: docs
c2: generate-robust
c3: instruction-doc
title: Robust Instruction Document Generator
description: Creates high-reproducibility instruction documents from brief descriptions by complementing existing information and following standard procedures and quality criteria.
usage: climpt-docs generate-robust instruction-doc -i=description -o instruction.md
options:
  stdin: true
  destination: true
---

これは「指示書作成」の指示である。以下の記述に従い、指示書を作成して。

# 0. 目的・適用範囲

- **目的**:
  短い「指示したい内容」から、既存レポジトリや関連資料を調査し、変更に強く、再現性の高い指示書を作成する。
- **適用範囲**: 内部利用・外部公開問わず、あらゆる指示書作成に適用。
- **非適用範囲**: 仕様変更に伴う個別コマンド例や特定ツールの操作マニュアル化。

---

# 1. 不変条件（壊してはならない性質）

1. 成果物は第三者が同じ手順で再現可能（再現差分 ≤ 5%）。
2. 曖昧語（例：適宜、十分に、迅速に）は全体の2%以下。
3. 成果物内の用語は用語集と完全一致、未解決代名詞なし。
4. 指示内容のトレーサビリティ100%。
5. 情報補完に使った一次資料は明示的に記録。

---

# 2. 入力・前提条件

- **入力**: `{text_input}`
- **前提**:
  - レポジトリや関連資料から不足情報を補完可能であること。
  - ツール・環境は可変のため、ツール非依存の設計とする。
- **禁止事項**:
  - 固有のファイル名・コマンド名を本文直書きしない（必要なら付録に隔離）。

---

# 3. 変数や可変コマンドの挿入判断

## 3.1 ブランチ作成指示

プロンプトの内容が、構築、リファクタなど、調査系以外のタスクか判断する。（調査系以外であった：
Gitブランチ=true）
調査系以外ブランチ準備が必要（Gitブランチ=true）な場合、以下のテキストをプロンプトへ記載する。（手順の最初に必要）

```
- Gitブランチ準備: `echo "<今回のテストコード改善内容を30文字以内で表現>" | climpt-git decide-branch working-branc` を実行し、出力結果の指示に従う。
```

## 3.2 変数の設置

`{input_text}`
のように、入力値に依存したプレースホルダーを使うか判断する。汎用的指示にしつつ、実行時に定める値が重要なプロンプトの場合、変数を用いる。

input_text: テキスト文の入力 input_text_file: 入力ソースファイルのPATH記述
destination_path: 出力先のPATH記述 uv-<variable_name>:
variable_nameを自由に定めることがdけいる短文テキスト変数（例: uv-scope:
スコープ名を期待する変数として定義 ）

利用する場合、フロントマターに変数リストと説明文を記載すること。

# 4. 手順

## 4.0 事前情報収集（短文補完フェーズ）

- 狙い: 短いinput_textから不足情報を補い、以降の指示書作成を可能にする。
- 手順:
  1. 対象レポジトリを調査し、プロジェクトの目的・ドメイン・使用言語・主要構造を特定。
  2. 関連ドキュメント（README、設計書、API仕様、コメントなど）を抽出。
  3. 指示内容に直接関係する部分を要約し、**前提情報リスト**として記載。
  4. 不明点が残る場合は仮定を置き、「仮定リスト」として明示。
- 完了条件:
  - 前提情報リストと仮定リストが完成し、後続手順に必要な情報が揃っている。

## 4.1 タイトルを決める

- 狙い: 短文と前提情報から内容を簡潔に表現し、後続作業の指針とする。
- 判断基準: 抽象度が高すぎず、対象範囲を明確化。

## 4.2 概要を作成する

1. 100〜200文字で概要文を作成。
2. タイトルと概要の適合性をチェック。
3. 適合性検証として、タイトル＋概要＋前提情報リストをもとに24本の指示を生成。
4. 生成結果の**類似度中央値（MedSim）**を算出（評価方法は第5章）。
5. `MedSim < 0.82` かつ該当比率 > 50%の場合、3.1へ戻る。

## 4.3 指示内容を構築する

- 狙い: 不変条件を満たし、再現性と冪等性を確保。
- 判断基準: 開始条件、終了条件、品質基準を明記。

## 4.4 成果物を定義する

- 主成果物: 本文指示書
- 付録: 用語集、禁止語一覧、変化点リスト、レビュー票、前提情報リスト、仮定リスト
- DoD（Definition of Done）:
  - 不変条件をすべて満たすこと
  - 前提情報リストが網羅されていること

## 4.5 参照資料を記載する

- 一次資料（規格・公式ドキュメント）→二次資料（記事・解説）の順で列挙。
- 各資料の利用目的と範囲を1行注釈。

## 4.5.1 必須の参照資料(コード変更用)

- コード変更用プロンプトの場合、必ず参照資料へ記載

```
- **全域性原則**: `docs/development/totality_go.ja.md`
- [AI複雑化防止（科学的制御）](docs/development/ai-complexity-control_compact.ja.md)
```

## 4.6 作業方法を決定する

- Draft → 自己チェック → 24本評価 → ドライラン → レビュー承認 → リリース。

---

# 5. 記載の粒度

1. **思考プロセス重視**
   - なぜそれを行うのか、どう考えるべきかを記載。
2. **ツール非依存**
   - コマンド例ではなく、必要な処理の性質や判断基準を記載。

---

# 6. 品質検証方法（24本評価）

- **正規化手順**: 記号除去 → 全半角統一 → 数値を`<NUM>`化 → 日本語2-gram化
- **類似度計算式**:
  - レーベンシュタイン類似度:\
    `sim_lev(a,b) = 1 - Lev(a,b) / max(|a|, |b|)`
  - ジャッカード係数（2-gram）:\
    `sim_jac(A,B) = |A∩B| / |A∪B|`
  - 合成スコア:\
    `sim(a,b) = 0.5*sim_lev + 0.5*sim_jac`
- **ブレ幅判定**:
  - 入力: タイトル＋概要＋前提情報リスト
  - MedSim = 全組合せ類似度の中央値
  - MedSim < 0.82 かつ該当比率 > 50% → 再生成
  - 最大3ラウンドまで実施し、MedSim ≥ 0.86で確定。

---

# 7. 変更履歴（例）

- v1.0 初版作成
- v1.1 品質検証手順を追加
- v1.2 不変条件を強化
- v1.3 短文input_text対応・事前情報収集ステップ追加

# 8. 指示書の区別

この指示は「プロンプト作成」の指示である。
作成中に、「本来なら指示書のために記載していたのに、いつの間にか作成した指示に従ってしまっていた」状態にならないよう、混乱しない術を用いること。

・この作業のための出力を得たのか
・作成中プロンプトの内容を指示だと勘違いしていないか

# 出力先

{destination_path}
