# `claude -p` を使った処理パターン

# 処理の分解

claude -p で処理する時に、1度に処理すると整合を撮りにくい。
そこで、抽出とパターンマッチを分離する。

## 1. 抽出

### 1-1. TypeScript処理

以下について、TypeScriptで確実に抽出する。

1. プロンプトからフロントマターのみを抽出する
1-1. yaml データとして取得する（フロントマターYAML）
2. プロンプトに用いられている `{variable}` 名称を抽出する（テンプレート変数抽出）

### 1-2. `claude -p` でフロントマターを処理する

1. フロントマターYAMLに記載のある項目を、Schema情報へ対応させるように変換させる。
2. 結果をSchemaのJSON形式で保持する。

指示の趣旨は、表記揺れや、キーの名称の階層構造ズレを修正させることが目的。

ルール:
- 値を加工しない。
- 明らかに存在しない項目は、値を作らない。

### 1-3. `claude -p` でテンプレート変数を処理する

1. 抽出した変数を、Schemaに基づいてオプション有無に変換する。
