# 実装品質チェックリスト - GitHub Issues分析による再発防止

このチェックリストは、過去のissueから学んだ教訓をもとに、同じ実装間違いを防ぐためのものです。\
新機能実装・リファクタリング・バグ修正時に必ず確認してください。

## 🔴 設計原則チェックリスト

### Totality原則の遵守

- [ ] 新しい関数は全域関数として実装されているか？
- [ ] `throw new Error`を使用していないか？（Result型を使用すること）
- [ ] 例外処理とResult型が同一ファイル内で混在していないか？
- [ ] エラーケースは型システムで表現されているか？
- [ ] Smart Constructorパターンを適用しているか？
- [ ] 部分関数になりうる箇所はないか？
- [ ] createOrDefaultパターンでフォールバック値を提供しているか？

### ハードコーディング防止

- [ ] 文字列リテラルを直接記述していないか？（定数化されているか）
- [ ] 配列・オブジェクトのキーが直接記述されていないか？
- [ ] マジックナンバーを使用していないか？（Smart Constructor化されているか）
- [ ] 拡張プロパティ名（x-*）が直接記述されていないか？
- [ ] ファイル拡張子リストがハードコードされていないか？
- [ ] 正規表現パターンが設定可能になっているか？
- [ ] 言語固有の処理（英語複数形など）が抽象化されているか？

### DDD境界の遵守

- [ ] レイヤー間の責務が明確に分離されているか？
- [ ] ドメインロジックがアプリケーション層に漏れていないか？
- [ ] 依存関係の方向が正しいか？（外側→内側）
- [ ] Value Objectは不変性を保っているか？
- [ ] Entityの一意性が保証されているか？

## 🟡 実装パターンチェックリスト

### エラーハンドリング

- [ ] Result<T, E>型を一貫して使用しているか？
- [ ] エラーの種類（kind）が適切に定義されているか？
- [ ] エラーメッセージが具体的で有用か？
- [ ] エラー時の戻り値が予測可能か？
- [ ] フォールバック処理が適切に実装されているか？

### テンプレート処理

- [ ] テンプレート変数の抽出が正しく動作するか？
- [ ] 集約モードでもテンプレート処理がバイパスされないか？
- [ ] {id.full}などの変数置換が正しく行われるか？
- [ ] x-template設定が正しく読み込まれるか？
- [ ] テンプレートファイルが存在しない場合の処理があるか？

### 設定の抽象化

- [ ] 新しい設定項目は外部から注入可能か？
- [ ] デフォルト値が適切に設定されているか？
- [ ] 設定のバリデーションが実装されているか？
- [ ] 設定変更時にコード修正が不要か？
- [ ] プラグイン形式での拡張が可能か？

## 🟢 テストチェックリスト

### テストカバレッジ

- [ ] 新機能に対するユニットテストを作成したか？
- [ ] エッジケースのテストを含んでいるか？
- [ ] エラーケースのテストを作成したか？
- [ ] 統合テストで実際のワークフローを検証したか？
- [ ] E2Eテストで完全なフローを確認したか？

### テストの品質

- [ ] テストが仕様を正確に反映しているか？
- [ ] テストコード自体にハードコーディングがないか？
- [ ] モックに過度に依存していないか？
- [ ] 実際のファイルI/Oを伴うテストがあるか？
- [ ] テストが独立して実行可能か？

### テスト重複の防止

- [ ] テストセットアップコードを共通化したか？
- [ ] TestFactoryパターンを使用しているか？
- [ ] アサーションヘルパーを活用しているか？
- [ ] 重複するテストデータを定数化したか？

## 🔵 CLI/ユーザビリティチェックリスト

### 出力とフィードバック

- [ ] 処理結果が必ず出力されるか？
- [ ] エラー時に明確なメッセージが表示されるか？
- [ ] 成功時にサマリーが表示されるか？
- [ ] verboseモードが正しく動作するか？
- [ ] exit codeが適切に設定されているか？

### 引数処理

- [ ] CLI引数のバリデーションが適切か？
- [ ] ヘルプメッセージが有用か？
- [ ] デフォルト値が適切に設定されているか？
- [ ] エラー時の回復処理があるか？

## ⚫ アーキテクチャチェックリスト

### サービス統合

- [ ] 新規サービスがメインアプリケーションに統合されているか？
- [ ] DIコンテナまたはFactoryパターンで注入されているか？
- [ ] サービス間の依存関係が明確か？
- [ ] 循環参照が発生していないか？

### 拡張性

- [ ] 新機能追加時の影響範囲が限定的か？
- [ ] インターフェースによる抽象化が適切か？
- [ ] プラグインとして実装可能な設計か？
- [ ] 将来の変更に対して柔軟か？

### パフォーマンス

- [ ] 不要なループや再計算がないか？
- [ ] メモリリークの可能性はないか？
- [ ] 大量データ処理時の考慮があるか？
- [ ] 並行処理の必要性を検討したか？

## 📝 ドキュメントチェックリスト

### コードドキュメント

- [ ] 複雑なロジックにコメントがあるか？（必要な場合のみ）
- [ ] 型定義が明確で理解しやすいか？
- [ ] JSDocコメントが適切に記述されているか？

### プロジェクトドキュメント

- [ ] READMEに新機能の説明を追加したか？
- [ ] APIドキュメントを更新したか？
- [ ] 破壊的変更がある場合、マイグレーションガイドを作成したか？

## ⚠️ よくある実装ミスパターン

### 避けるべきパターン

1. **特殊解の実装** - 一般解として設計すること
2. **英語前提の処理** - 多言語対応を考慮すること
3. **直接的な文字列比較** - 設定可能な配列/マップを使用すること
4. **if文の多用** - ポリモーフィズムやStrategy パターンを検討すること
5. **グローバル状態の使用** - 依存注入を使用すること
6. **同期的I/O処理** - 非同期処理を検討すること

### 推奨パターン

1. **Result型の使用** - 例外処理の代わりに
2. **Smart Constructor** - バリデーション付きオブジェクト生成
3. **Factory/Builder** - 複雑なオブジェクトの生成
4. **Repository** - データアクセスの抽象化
5. **Value Object** - ドメインロジックのカプセル化
6. **Dependency Injection** - 疎結合な設計

## 🚀 リリース前チェックリスト

### 最終確認

- [ ] 全テストが通過しているか？
- [ ] カバレッジが80%以上を維持しているか？
- [ ] Lintエラーがないか？
- [ ] 型チェックが通過しているか？
- [ ] CI/CDパイプラインが正常動作するか？
- [ ] パフォーマンステストを実施したか？
- [ ] セキュリティ脆弱性スキャンを実施したか？

### デプロイ準備

- [ ] CHANGELOGを更新したか？
- [ ] バージョン番号を更新したか？
- [ ] リリースノートを作成したか？
- [ ] 破壊的変更の影響を文書化したか？

---

**使用方法**:

1. 新機能実装時：関連するセクションをすべて確認
2. バグ修正時：エラーハンドリングとテストセクションを重点確認
3. リファクタリング時：設計原則とアーキテクチャセクションを重点確認
4. PR作成時：最低限、赤🔴と黄🟡セクションを確認

**注意**:
このチェックリストは継続的に更新されます。新しい問題パターンが発見された場合は追加してください。
