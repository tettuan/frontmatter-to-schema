---
title: "CLI ユーザビリティ改善とドキュメント整備指示書"
description: "優秀な内部アーキテクチャを持つ frontmatter-to-schema の CLI インターフェースをユーザーフレンドリーに改善する"
version: 1.0
created: 2025-09-16
target: Issue #863
variables:
  - input_text: 改善対象の具体的な CLI 機能や問題点
  - destination_path: 改善されたドキュメントやサンプルの出力先
---

# CLI ユーザビリティ改善とドキュメント整備指示書

## 目的・適用範囲

**目的**: 技術的に優秀な frontmatter-to-schema プロジェクトの CLI
インターフェースを、ユーザーが直感的に使用できるレベルまで改善し、プロジェクトの採用を促進する。

**適用範囲**:

- CLI の引数処理とエラーハンドリング
- examples/ ディレクトリの動作保証
- ユーザー向けドキュメント
- 権限要件の明確化

**非適用範囲**:

- 内部アーキテクチャの変更（DDD/Totality 設計は維持）
- コア機能の仕様変更

## 不変条件（壊してはならない性質）

1. 内部の DDD アーキテクチャと Totality 原則を維持する
2. 既存の CI テスト（249 テスト）が全て成功し続ける
3. Result 型による関数型エラーハンドリングパターンを維持する
4. examples/ 内の全サンプルが documented コマンドで動作する
5. CLI エラーメッセージは解決方法を含む

## 前提条件・入力

**前提条件**:

- Issue #863 が作成済みで、具体的な問題が特定されている
- CI パイプラインが完全パス状態である
- プロジェクトの内部品質が高い状態である

**主要な問題点（Issue #863 より）**:

1. ディレクトリパス処理の未対応
2. Glob パターン処理の未対応
3. 権限要件（--allow-env）の不明確さ
4. Schema-input ファイル関係の説明不足

## 実装手順

### Gitブランチ準備

```bash
echo "CLI usability improvements for Issue 863" | climpt-git decide-branch working-branch
```

### Phase 1: CLI 引数処理の改善

#### 1.1 ディレクトリ処理の実装

**目標**: `cli.ts examples/2.climpt/prompts/`
のようなディレクトリ指定を可能にする

**実装方針**:

- ディレクトリが指定された場合、内部で `*.md` パターンに展開
- ファイル存在チェックを事前に実行
- 明確なエラーメッセージで不正パスを通知

**完了条件**:

- [ ] ディレクトリパス指定でのファイル自動検出
- [ ] サブディレクトリの再帰処理オプション
- [ ] 見つからない場合の親切な案内メッセージ

#### 1.2 Glob パターン対応

**目標**: `"examples/**/*.md"` のような柔軟なファイル指定を可能にする

**実装方針**:

- Deno 標準の glob 機能を活用
- シェルエスケープ処理を適切に実装
- パターンマッチ結果の事前表示オプション

**完了条件**:

- [ ] ワイルドカード パターンの解釈
- [ ] 複数パターンの同時指定
- [ ] マッチしたファイル一覧の確認機能

### Phase 2: 権限要件の標準化

#### 2.1 統一権限セットの定義

**目標**: ユーザーが迷わない標準的な権限指定を提供

**実装方針**:

- 最小権限の組み合わせを特定
- 用途別の権限セット（dev/prod）を定義
- help テキストに権限要件を明記

**完了条件**:

- [ ] 標準権限セット: `--allow-read --allow-write --allow-env`
- [ ] debug 用権限セット: 上記 + `--allow-run`
- [ ] help テキストでの権限説明

#### 2.2 権限エラーの改善

**目標**: 権限不足時に具体的な解決方法を提示

**実装方針**:

- エラー発生時に必要な権限を具体的に表示
- コピペ可能な正しいコマンド例を提示
- 権限が不要な代替手段があれば案内

### Phase 3: examples/ の動作保証

#### 3.1 全サンプルの動作検証

**目標**: README や文書に記載されたコマンドが全て動作する

**検証対象**:

- `examples/0.basic/` の基本例
- `examples/2.climpt/` の複雑な例
- `examples/1.articles/` の記事例

**実装方針**:

- 各サンプルディレクトリに `run.sh` を配置
- CI での自動テストに含める
- README.md の更新

**完了条件**:

- [ ] 全 examples/ のコマンドが成功
- [ ] CI での examples/ テスト実行
- [ ] 各サンプルの README 更新

### Phase 4: ドキュメント整備

#### 4.1 CLI help の充実

**目標**: `--help` で十分な情報を提供

**内容**:

- 基本的な使用方法
- 権限要件の説明
- よくあるエラーと対処法
- 実用的なコマンド例

#### 4.2 トラブルシューティングガイド

**出力先**: `{destination_path}/troubleshooting.md`

**内容**:

- 権限エラーの対処法
- ファイルが見つからない場合の対処
- Schema validation エラーの読み方
- よくある質問（FAQ）

### Phase 5: エラーメッセージの改善

#### 5.1 建設的なエラーメッセージ

**目標**: エラー発生時にユーザーが次に何をすべきかわかる

**改善方針**:

- 「何が問題か」→「どう修正するか」の構造
- 具体的なファイルパスやコマンド例を含む
- 関連ドキュメントへのリンク

**完了条件**:

- [ ] File not found → 近似ファイルの提案
- [ ] Permission denied → 必要な権限の具体的提示
- [ ] Schema error → 該当行番号とサンプル

## 品質検証方法

### 動作テスト

1. **基本動作**: 各 examples/ で documented コマンドを実行
2. **エラーハンドリング**: 意図的にエラーを発生させてメッセージを確認
3. **権限テスト**: 最小権限での動作確認

### ユーザビリティテスト

1. **初回利用者**: プロジェクトを知らない人が README だけで動かせるか
2. **エラー遭遇**: エラーメッセージだけで解決できるか
3. **逆引き**: やりたいことから適切なコマンドを見つけられるか

## 完了条件（DoD）

### 必須項目

- [ ] Issue #863 の全チェックボックスが完了
- [ ] examples/ の全サンプルが documented コマンドで動作
- [ ] CI テストが全て成功（リグレッション無し）
- [ ] help テキストに権限要件が明記
- [ ] トラブルシューティングガイドが作成

### 品質項目

- [ ] 新規ユーザーが 15分以内に最初の成功体験を得られる
- [ ] エラーメッセージから解決方法が 90% 推測可能
- [ ] ドキュメントの内容と実際の動作が一致

## 参照資料

### 必須参照資料

- **全域性原則**: `docs/development/totality.ja.md`
- **AI複雑化防止（科学的制御）**:
  `docs/development/ai-complexity-control_compact.ja.md`
- **ハードコーディング禁止規定**: `docs/development/prohibit-hardcoding.ja.md`

### 技術資料

- Issue #863: CLI Usability and Documentation Improvements
- `examples/` ディレクトリ: 実際のサンプルケース
- `cli.ts`: 現在の CLI 実装
- CI ログ: 現在のテスト成功パターン

### 品質基準

- DDD アーキテクチャ文書: コアロジックの変更禁止
- Totality 原則: Result 型パターンの維持

## 作業方法

1. **Phase 単位での実装**: 各 Phase を独立して完了
2. **継続的検証**: 各変更後に examples/ での動作確認
3. **ユーザー視点**: 技術者でないユーザーの視点でテスト
4. **文書と実装の同期**: コード変更時に必ずドキュメント更新

## 注意事項

### 維持すべき品質

- DDD アーキテクチャパターン
- Result 型による関数型エラーハンドリング
- 現在の高いテストカバレッジ

### 避けるべき変更

- コアドメインロジックの修正
- エラー型の構造変更
- 既存 API の破壊的変更

この指示書により、技術的に優秀な frontmatter-to-schema
プロジェクトのユーザビリティが大幅に向上し、ユーザー採用が促進されることを目指す。
