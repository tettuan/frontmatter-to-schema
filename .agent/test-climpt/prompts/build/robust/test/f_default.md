---
c1: build
c2: robust
c3: test
title: Robust Test Construction
description: Constructs robust and resilient tests based on domain-driven design and totality principles.
usage: climpt-build robust test -f requirements.md -i=additional_instructions -o test_output/
options:
  input_file: [true]
  stdin: [true]
  destination: [true]
---

# テスト 強固構築

ドメイン駆動設計と全域性（Totality）原則に基づいた、強固で堅牢なテスト構築を行う。

## 強固構築方針

- **ドメイン駆動設計**: ビジネスロジックの核心を保護するテスト設計の明確化
- **全域性原則**:
  型安全性によるテスト不安定状態の完全排除（`docs/development/totality_go.ja.md`参照）
- **テスト分離**: ユニットテストと統合テストの明確な責務分離による安定性確保
- **強固性重視**:
  再現性、冪等性、シンプルさを重視したコアテストによる堅牢な品質保証
- **最小テスト最大カバレッジ**:
  コードベース変更に強い最小限のテストでの広範囲カバレッジ
- [AI複雑化防止（科学的制御）](docs/development/ai-complexity-control_compact.ja.md)

## 必須参照資料

必ず以下の資料を参照してから強固な設計・実装を開始すること：

1. **ドメイン設計**: `docs/domain/design_domain_boundary-*.md`
2. **サブドメイン設計**: `docs/domain/architecture/**/*.md`
3. **全域性原則**: `docs/development/totality_go.ja.md`
4. **プロジェクト構造**: `docs/architecture/domain-driven-implementation.md`
5. **テスト方針**: `docs/tests/README.md`, `docs/tests/testing_guidelines.md`
6. **テスト実装**: `tests/`, `internal/*/test.go` 既存実装

## 強固構築手順

2. **ブランチ準備**

Gitブランチ準備:
`echo "<今回のテストコード改善内容を30文字以内で表現>" | climpt-git decide-branch working-branc`
を実行し、出力結果の指示に従う。

3. **仕様理解・調査**
   - `{input_text_file}` の内容分析と強固性要件の特定
   - 既存テスト実装の調査（`tests/`, `internal/*/test.go`）
   - ドメイン設計資料とテスト方針の読み込み

### Phase 2: 強固設計・計画

4. **強固テスト設計**
   - 対象ドメインのコアテスト戦略定義（変更耐性重視）
   - ユニットテストと統合テストの明確な分離設計
   - 最小テスト最大カバレッジ戦略の策定

5. **強固テストアーキテクチャ設計**
   - テストヘルパーの統一設計（再現性・冪等性保証）
   - モックとスタブの戦略（依存関係分離）
   - テストデータ管理戦略（クリーンアップ・独立性）

6. **強固実装計画**
   - テスト対象とテストスコープの明確化
   - コアテストとエッジケーステストの優先度分離
   - タスク分割とワーカー割り当て

### Phase 3: 強固実装

7. **コア強固実装**
   - ユニットテストの実装（ビジネスロジック保護）
   - 統合テストの実装（システム境界検証）
   - テストヘルパーの実装（再現性・冪等性保証）
   - テストデータ管理の実装（独立性・クリーンアップ徹底）

8. **テスト安全性強化**
   - テスト分離の徹底（並列実行安全性）
   - モック・スタブの適切な利用（依存関係制御）
   - テスト環境の統一（環境差分排除）

### Phase 4: 徹底テスト・検証

9. **強固テスト検証**
   - ユニットテストの実行・検証（高速・独立性確認）
   - 統合テストの実行・検証（実環境想定）
   - テストカバレッジの測定・分析（コア機能重点確認）

10. **品質検証**
    ```bash
    # 高速ユニットテスト
    make test-unit

    # 統合テスト
    make test-integration

    # 全テスト
    make test

    # カバレッジ測定
    make test-coverage
    ```

### Phase 5: 堅牢ドキュメント化

11. **テスト設計書作成**
    - `docs/tests/README.md` - テスト全体概要（強固性ポリシー含む）
    - `docs/tests/unit/*.md` - ユニットテスト仕様（コア機能重点）
    - `docs/tests/integration/*.md` - 統合テスト仕様（システム境界検証）

12. **実装ドキュメント更新**
    - テスト戦略図の更新（最小テスト最大カバレッジ含む）
    - テスト実行ガイドの更新（CI/CD連携含む）

13. コミット

- 最後に `climpt-commit semantic units`
  を実行し、表示された指示に従ってください。

## 強固構築内容

`{input_text_file}`の内容に基づいて以下を強固に構築する：

### 必須成果物

- [ ] ユニットテスト強固実装（ビジネスロジック保護・高速実行・独立性保証）
- [ ] 統合テスト強固実装（システム境界検証・実環境模擬・シンプル設計）
- [ ] テストヘルパー統一（再現性・冪等性・最小コード重複）
- [ ] テストカバレッジ戦略（コア機能重点・エッジケース分離）
- [ ] テスト設計書一式（強固性ポリシー・実行ガイド含む）
- [ ] CI/CD統合（自動テスト実行・品質ゲート）

### 強固性基準

- **シンプルさ**: 理解しやすく保守しやすいテスト設計
- **安全性**: 並列実行安全・環境独立・副作用なし
- **再現性**: 同じ入力で同じ結果・環境差分なし
- **冪等性**: 何度実行しても同じ結果・状態変化なし
- **最小テスト最大カバレッジ**: コードベース変更に強い効率的テスト
- **変更耐性**: リファクタリングや機能追加に対する頑健性

## 追加指示

{input_text}

## 完了条件

1. **強固実装完了**
   - `{input_text_file}` の要件を満たす強固なテスト実装完了
   - ユニットテストと統合テストの明確な分離とコア機能の重点保護

2. **品質確保**
   - `deno task ci` がエラー0件で通過
   - ユニットテスト高速実行（独立性・並列安全性確認）
   - 統合テストシステム検証（実環境想定・境界値確認）

3. **ドキュメント完備**
   - テスト設計書一式の作成完了（強固性ポリシー・実行ガイド含む）
   - CI/CD統合ドキュメントの更新完了（自動化・品質ゲート含む）

## 強固構築開始指示

最初にタスクを洗い出し、漏れなくリスト化してください。
その後、指示の意図と仕様理解を行いながら、順番に作業します。
コードベースの頻繁な変更に耐える、シンプルで安全な強固テストの構築を開始してください。
