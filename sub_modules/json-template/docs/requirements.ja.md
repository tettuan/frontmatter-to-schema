# JSONテンプレート処理サブモジュール 要求事項

## 概要

JSONデータとテンプレートファイルを受け取り、変数置換を行って構造化されたJSONを出力するサブモジュール。

## スコープ

- **入力**: JSONデータとテンプレートファイルPATH
- **処理**: テンプレートファイルをテキストとして扱い、基本的な変数置換を実行
- **出力**: 置換結果をJSONとしてParseし、構造化されたJSONを返却

**制限事項**:
- `{@items}` による配列展開機能は含まない
- テンプレート変数のネスト（`{{recursive_variablename}}`のような再帰的変数展開）は含まない

## 要求事項

### 1. 基本機能

1. JSONデータとテンプレートファイルパスを受け取る
2. テンプレートファイルを読み込み、テキストデータとして処理
3. テンプレート内の変数を実際のJSONデータの値に置換
4. 置換完了後のテキスト全体をJSONとしてパース
5. パースしたJSONオブジェクトを返却

### 2. テンプレート処理の基本原則

**重要**: テンプレートは出力フォーマットを完全に定義する。テンプレートに記載されたもののみが出力される。

- テンプレートファイルに書かれた内容がそのまま出力フォーマットとなる
- `{variable.path}` 形式の変数のみが実際の値に置換される
- データによる構造の補完や追加は一切行われない

### 3. 変数置換機能

#### 基本変数置換

テンプレート内の `{variable.path}` 形式の変数を、JSONデータの対応する値に置換する。

**パス記法**:
- ドット記法: `{id.full}` → JSONデータの `data.id.full` の値
- 配列アクセス: `{items[0].name}` → JSONデータの `data.items[0].name` の値
- 単純変数: `{version}` → JSONデータの `data.version` の値

### 4. データ構造と変数参照

#### テンプレートでの変数参照

テンプレート処理時は、JSONデータのrootが起点となる：

```json
// JSONデータ例
{
  "version": "1.0.0",
  "description": "Example data",
  "tools": {
    "availableConfigs": ["git", "test"],
    "commands": [
      {"c1": "git", "c2": "create", "title": "Create Git Issue"}
    ]
  }
}

// テンプレート例
{
  "version": "{version}",
  "description": "{description}",
  "tools": {
    "availableConfigs": "{tools.availableConfigs}",
    "firstCommand": "{tools.commands[0].title}"
  }
}
```

### 5. 処理フロー

```
入力: JSONデータ + テンプレートファイルパス
  ↓
1. テンプレートファイルの読み込み
  ↓
2. テンプレート内容をテキストとして解析
  ↓
3. 変数 {variables} の特定と置換
  ↓
4. 全変数置換完了後のテキストをJSONパース
  ↓
出力: 構造化されたJSONオブジェクト
```

### 6. エラーハンドリング

- テンプレートファイルが存在しない場合のエラー処理
- JSONデータに存在しない変数が参照された場合の処理
- テンプレート置換後のテキストがJSONとして無効な場合のエラー処理

### 7. 設計原則

1. **単一責任**: テンプレート処理のみに専念
2. **依存性の排除**: フロントマター解析、Schema処理から完全に独立
3. **型安全性**: TypeScriptによる堅牢な型定義
4. **テスタビリティ**: 単体テストが容易な設計
5. **再利用性**: 他のプロジェクトでも使用可能な汎用性

### 8. インターフェース定義

```typescript
interface JsonTemplateProcessor {
  /**
   * JSONデータとテンプレートファイルパスを受け取り、
   * 変数置換を行ったJSONオブジェクトを返す
   */
  process(jsonData: any, templateFilePath: string): Promise<any>;
}
```

### 9. 非機能要件

- **パフォーマンス**: 大量のデータ処理に対応
- **メモリ効率**: 大きなJSONファイルでもメモリ効率的に処理
- **エラー情報**: デバッグ時に有用な詳細エラー情報の提供
- **ロギング**: 処理過程の追跡可能なログ出力

### 10. テスト要件

- 基本的な変数置換のテスト
- ネストした変数参照のテスト（ドット記法）
- 配列アクセス（インデックス指定）のテスト
- 存在しない変数参照のテスト
- エラーケースのテスト
- パフォーマンステスト
- エッジケース（空データ、特殊文字等）のテスト

## 成果物

1. JSONテンプレート処理機能の実装
2. 包括的なテストスイート
3. APIドキュメント
4. 使用例とサンプルコード
5. パフォーマンス計測結果